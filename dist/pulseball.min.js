/*! PulseBall 0.0.1 Copyright Â© 2015 Fabio Soggia - Released under the MIT Licence */
var PULSEBALL=function(a,b){"use strict";function c(a){return JSON.parse(JSON.stringify(a))}function d(a){this.table=c(a),this.index=[],this.updatePositions()}function e(a,b){return a.name===b.country}function f(a,b,c){var d=a.rating;e(a,c)&&(d+=3);var f=b.rating;e(b,c)&&(f+=3);var g=d-f;return g=i.min(10,g),g=i.max(-10,g)}function g(a,b){var c,d=0,e=0,f=b/10;switch(a){case"A":c=1-f,d=c,e=-c;break;case"B":c=1+f,d=-c,e=c;break;case"D":d=f,e=f}return[d,e]}function h(a,b){var c=b.teams;c[0].rating=a.getTeamPts(c[0].id),c[1].rating=a.getTeamPts(c[1].id);var d=f(c[0],c[1],b.venue),e=g(b.outcome,d);return a.setTeamPts(c[0].id,c[0].rating+e[0]),a.setTeamPts(c[1].id,c[1].rating+e[1]),a}var i=a.Math;d.prototype.updatePositions=function(){this.table.sort(function(a,b){return b.pts-a.pts});for(var a=this.table.length,b=0;a>b;b++){var c=this.table[b],d=b+1;c.pts!==c.oldPts&&(c.oldPos=c.pos),c.pos!==d&&(c.pos=d),this.index[c.team.id]=c}},d.prototype.toJson=function(){return c(this.table)},d.prototype.clone=function(){var a=this.toJson();return new d(a)},d.prototype.getTeamPosition=function(a){if(a in this.index){var b=this.index[a];return b.pos}return-1},d.prototype.teamExists=function(a){return-1!==this.getTeamPosition(a)},d.prototype.getTeamPts=function(a){var b=this.getTeamPosition(a)-1;return-1===b?-1:this.table[b].pts},d.prototype.setTeamPts=function(a,b){var c=this.getTeamPosition(a)-1;-1!==c&&(this.table[c].oldPts=this.table[c].pts,this.table[c].pts=1*b.toFixed(2),this.updatePositions())};var j;return{init:function(a){j=new d(a)},addMatch:function(a){if(!j)throw Error("You must call the init() function before add a match.");var b=h(j.clone(),a);return"C"===a.status&&(j=b),b.toJson()}}}(window);